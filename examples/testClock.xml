<beast version='2.0'
       namespace='beast.pkgmgmt:beast.base.core:beast.base.inference:beast.base.evolution.tree.coalescent:
             beast.pkgmgmt:beast.base.core:beast.base.inference.util:beast.evolution.nuc:
             beast.base.evolution.operator:beast.base.inference.operator:beast.base.evolution.sitemodel:
             beast.base.evolution.substitutionmodel:beast.base.evolution.branchratemodel:
             beast.base.evolution.likelihood:beast.base.inference.parameter:
             rc.beast.evolution.clockmodel'>

    <!-- The sequence alignment (each sequence refers to a taxon above).         -->
    <!-- ntax=6 nchar=768                                                        -->
    <!-- npatterns=69                                                            -->
    <data id="alignment" dataType="nucleotide">
        <sequence taxon="human">
            AGAAATATGTCTGATAAAAGAGTTACTTTGATAGAGTAAATAATAGGAGCTTAAACCCCCTTATTTCTACTAGGACTATGAGAATCGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCGTACTAAGAAATTTAGGTTAAATACAGACCAAGAGCCTTCAAAGCCCTCAGTAAGTTG-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGACCAATGGGACTTAAACCCACAAACACTTAGTTAACAGCTAAGCACCCTAATCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAA-TCACCTCGGAGCTTGGTAAAAAGAGGCCTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCCAAAGCTGGTTTCAAGCCAACCCCATGGCCTCCATGACTTTTTCAAAAGGTATTAGAAAAACCATTTCATAACTTTGTCAAAGTTAAATTATAGGCT-AAATCCTATATATCTTA-CACTGTAAAGCTAACTTAGCATTAACCTTTTAAGTTAAAGATTAAGAGAACCAACACCTCTTTACAGTGA
        </sequence>
        <sequence taxon="chimp">
            AGAAATATGTCTGATAAAAGAATTACTTTGATAGAGTAAATAATAGGAGTTCAAATCCCCTTATTTCTACTAGGACTATAAGAATCGAACTCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTACACCCTTCCCGTACTAAGAAATTTAGGTTAAGCACAGACCAAGAGCCTTCAAAGCCCTCAGCAAGTTA-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATTAATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAATCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAA-TCACCTCAGAGCTTGGTAAAAAGAGGCTTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCTAAAGCTGGTTTCAAGCCAACCCCATGACCTCCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATTACAGGTT-AACCCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGATTAAGAGGACCGACACCTCTTTACAGTGA
        </sequence>
        <sequence taxon="bonobo">
            AGAAATATGTCTGATAAAAGAATTACTTTGATAGAGTAAATAATAGGAGTTTAAATCCCCTTATTTCTACTAGGACTATGAGAGTCGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCGTACTAAGAAATTTAGGTTAAACACAGACCAAGAGCCTTCAAAGCTCTCAGTAAGTTA-CAATACTTAATTTCTGTAAGGACTGCAAAACCCCACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATTAATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAATCAGC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTTGAATTTGCAATTCAATATGAAAA-TCACCTCAGAGCTTGGTAAAAAGAGGCTTAACCCCTGTCTTTAGATTTACAGTCCAATGCTTCA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCTAAAGCTGGTTTCAAGCCAACCCCATGACCCCCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATTACAGGTT-AAACCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGATTAAGAGGACCAACACCTCTTTACAGTGA
        </sequence>
        <sequence taxon="gorilla">
            AGAAATATGTCTGATAAAAGAGTTACTTTGATAGAGTAAATAATAGAGGTTTAAACCCCCTTATTTCTACTAGGACTATGAGAATTGAACCCATCCCTGAGAATCCAAAATTCTCCGTGCCACCTGTCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTCACATCCTTCCCGTACTAAGAAATTTAGGTTAAACATAGACCAAGAGCCTTCAAAGCCCTTAGTAAGTTA-CAACACTTAATTTCTGTAAGGACTGCAAAACCCTACTCTGCATCAACTGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATCAATGGGACTCAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAGTCAAC-TGGCTTCAATCTAAAGCCCCGGCAGG-TTTGAAGCTGCTTCTTCGAATTTGCAATTCAATATGAAAT-TCACCTCGGAGCTTGGTAAAAAGAGGCCCAGCCTCTGTCTTTAGATTTACAGTCCAATGCCTTA-CTCAGCCATTTTACCACAAAAAAGGAAGGAATCGAACCCCCCAAAGCTGGTTTCAAGCCAACCCCATGACCTTCATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAGGTTAAATTACGGGTT-AAACCCCGTATATCTTA-CACTGTAAAGCTAACCTAGCGTTAACCTTTTAAGTTAAAGATTAAGAGTATCGGCACCTCTTTGCAGTGA
        </sequence>
        <sequence taxon="orangutan">
            AGAAATATGTCTGACAAAAGAGTTACTTTGATAGAGTAAAAAATAGAGGTCTAAATCCCCTTATTTCTACTAGGACTATGGGAATTGAACCCACCCCTGAGAATCCAAAATTCTCCGTGCCACCCATCACACCCCATCCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTACACCCTTCCCGTACTAAGAAATTTAGGTTA--CACAGACCAAGAGCCTTCAAAGCCCTCAGCAAGTCA-CAGCACTTAATTTCTGTAAGGACTGCAAAACCCCACTTTGCATCAACTGAGCGCAAATCAGCCACTTTAATTAAGCTAAGCCCTCCTAGACCGATGGGACTTAAACCCACAAACATTTAGTTAACAGCTAAACACCCTAGTCAAT-TGGCTTCAGTCCAAAGCCCCGGCAGGCCTTAAAGCTGCTCCTTCGAATTTGCAATTCAACATGACAA-TCACCTCAGGGCTTGGTAAAAAGAGGTCTGACCCCTGTTCTTAGATTTACAGCCTAATGCCTTAACTCGGCCATTTTACCGCAAAAAAGGAAGGAATCGAACCTCCTAAAGCTGGTTTCAAGCCAACCCCATAACCCCCATGACTTTTTCAAAAGGTACTAGAAAAACCATTTCGTAACTTTGTCAAAGTTAAATTACAGGTC-AGACCCTGTGTATCTTA-CATTGCAAAGCTAACCTAGCATTAACCTTTTAAGTTAAAGACTAAGAGAACCAGCCTCTCTTTGCAATGA
        </sequence>
        <sequence taxon="siamang">
            AGAAATACGTCTGACGAAAGAGTTACTTTGATAGAGTAAATAACAGGGGTTTAAATCCCCTTATTTCTACTAGAACCATAGGAGTCGAACCCATCCTTGAGAATCCAAAACTCTCCGTGCCACCCGTCGCACCCTGTTCTAAGTAAGGTCAGCTAAATAAGCTATCGGGCCCATACCCCGAAAATGTTGGTTATACCCTTCCCATACTAAGAAATTTAGGTTAAACACAGACCAAGAGCCTTCAAAGCCCTCAGTAAGTTAACAAAACTTAATTTCTGCAAGGGCTGCAAAACCCTACTTTGCATCAACCGAACGCAAATCAGCCACTTTAATTAAGCTAAGCCCTTCTAGATCGATGGGACTTAAACCCATAAAAATTTAGTTAACAGCTAAACACCCTAAACAACCTGGCTTCAATCTAAAGCCCCGGCAGA-GTTGAAGCTGCTTCTTTGAACTTGCAATTCAACGTGAAAAATCACTTCGGAGCTTGGCAAAAAGAGGTTTCACCTCTGTCCTTAGATTTACAGTCTAATGCTTTA-CTCAGCCACTTTACCACAAAAAAGGAAGGAATCGAACCCTCTAAAACCGGTTTCAAGCCAGCCCCATAACCTTTATGACTTTTTCAAAAGATATTAGAAAAACTATTTCATAACTTTGTCAAAGTTAAATCACAGGTCCAAACCCCGTATATCTTATCACTGTAGAGCTAGACCAGCATTAACCTTTTAAGTTAAAGACTAAGAGAACTACCGCCTCTTTACAGTGA
        </sequence>
    </data>


    <parameter id="nodeLogRates" name="nodeRates"
               dimension="10"
               value="0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1"
               lower="-Infinity" upper="Infinity"/>


    <!-- B) Root log-rate (dimension=1) -->
<!--    <parameter spec="beast.base.inference.parameter.RealParameter" id="rootLogRate" name="rootLogRate"-->
<!--               dimension="1" value="0.01" lower="-Infinity" upper="Infinity"/>-->

    <parameter spec="beast.base.inference.parameter.RealParameter"
               id="rootLogRate" name="rootLogRate"
               dimension="1" value="0.0" lower="-Infinity" upper="Infinity"
               estimate="false"/>


    <!-- C) sigma^2 parameter for Brownian increments -->
    <parameter spec="beast.base.inference.parameter.RealParameter" id="sigma2" name="sigma2"
               value="0.05" lower="0.0" upper="100"/>

<!--    <parameter spec="beast.base.inference.parameter.RealParameter" id="meanRate" name="clock.rate"-->
<!--               value="0.01" lower="0.0" upper="Infinity"/> <parameter spec="beast.base.inference.parameter.RealParameter" id="meanRate" name="clock.rate"-->
<!--               value="0.01" lower="0.0" upper="Infinity"/>-->

    <input spec="AutoCorrelatedClockModel" id="autoCorrClock" tree="@tree" nodeRates="@nodeLogRates" rootLogRate="@rootLogRate"
           sigma2="@sigma2">
        <taylorOrder>16</taylorOrder>
        <normalize>false</normalize>
<!--        <clock.rate idref="meanRate"/>-->
    </input>

    <distribution id="autoCorrPrior" spec="rc.beast.evolution.clockmodel.AutoCorrelatedPrior"
                  tree="@tree" nodeRates="@nodeLogRates" rootLogRate="@rootLogRate" sigma2="@sigma2"/>

    <input spec='TreeLikelihood' id="treeLikelihood" data='@alignment' tree='@tree'>
        <siteModel spec='SiteModel' id="siteModel">
            <!-- The HKY substitution model (Hasegawa, Kishino & Yano, 1985)             -->
            <substModel spec='HKY' id="hky">
                <parameter name='kappa' idref='hky.kappa'/>
                <frequencies id='freqs' spec='Frequencies' data='@alignment'/>
            </substModel>
        </siteModel>
    </input>

    <tree spec='beast.base.evolution.tree.ClusterTree' id='tree' clusterType='upgma' taxa='@alignment'/>

    <parameter spec='beast.base.inference.parameter.RealParameter' id="hky.kappa">1.0</parameter>

    <parameter spec='beast.base.inference.parameter.RealParameter' id="popSize">1.0</parameter>


    <run spec="MCMC" id="mcmc" chainLength="2000000"> <!--autoOptimize="true"-->
        <state>
            <input name='stateNode' idref='hky.kappa'/>
            <input name='stateNode' idref='popSize'/>
            <input name='stateNode' idref='nodeLogRates'/>
            <input name='stateNode' idref='rootLogRate'/>
            <input name='stateNode' idref='sigma2'/>
<!--            <input name='stateNode' idref='meanRate'/>-->
            <input name='stateNode' idref='tree'/>
        </state>

        <distribution spec="CompoundDistribution" id="posterior">
            <distribution id="autoCorrPriorRef" idref="autoCorrPrior"/>
            <distribution id="coalescent" spec="Coalescent">
                <treeIntervals spec='beast.base.evolution.tree.TreeIntervals' id='TreeIntervals'>
                     <tree idref="tree"/>
                </treeIntervals>
                <populationModel spec="ConstantPopulation">
                    <parameter name="popSize" idref="popSize"/>
                </populationModel>
            </distribution>
            <distribution id='likelihood' idref="treeLikelihood"/>
        </distribution>

        <!--operator id="indicatorsRandomWalk" spec="UniformOperator" weight="1" parameter='@indicators'/-->
        <operator id='nodeLogRatesScaler' spec='ScaleOperator'
                  parameter='@nodeLogRates' scaleFactor="0.236" weight="2"/>
<!--        <operator id='rootLogRateScaler' spec='ScaleOperator'-->
<!--                  parameter='@rootLogRate' scaleFactor="0.5" weight="2"/>-->
        <operator id='sigma2Scaler' spec='ScaleOperator'
                  parameter="@sigma2" scaleFactor="0.5" weight="2.0" />
<!--        <operator id='meanRateScaler' spec='ScaleOperator'-->
<!--                  parameter='@meanRate' scaleFactor="0.0075" weight="2"/>-->



        <operator id="gompertzPopFuncUptreeDownOperator" spec="operator.UpDownOperator" scaleFactor="0.75" weight="3.0">
            <up idref="tree"/>
            <up idref="rootLogRate"/>
        </operator>


        <operator id='kappaScaler' spec='ScaleOperator' scaleFactor="0.5" weight="1" parameter='@hky.kappa'/>
        <operator id='popSizeScaler' spec='ScaleOperator' scaleFactor="0.5" weight="1" parameter='@popSize'/>

        <operator id='treeScaler' spec='ScaleOperator' scaleFactor="0.5" weight="1" tree='@tree'/>
        <operator spec='Uniform' weight="10"  tree='@tree'/>
        <operator spec='SubtreeSlide' weight="5" gaussian="true" size="1.0" tree='@tree'/>
        <operator id='narrow' spec='Exchange' isNarrow='true' weight="1" tree='@tree'/>
        <operator id='wide' spec='Exchange' isNarrow='false' weight="1" tree='@tree'/>
        <operator spec='WilsonBalding' weight="1" tree='@tree'/>

        <logger logEvery="10000" fileName="test.$(seed).log">
	    <model idref='posterior'/>
            <log idref="coalescent"/>
            <log idref="likelihood"/>
            <log spec='beast.base.evolution.tree.TreeHeightLogger'>
                <tree idref='tree'/>
            </log>
            <log idref="popSize"/>
            <log idref="hky.kappa"/>
            <log idref="nodeLogRates"/>
            <log idref="rootLogRate"/>
            <log idref="sigma2"/>
<!--            <log idref="meanRate"/>-->
            <log idref="posterior"/>
        </logger>
        <logger logEvery="10000" fileName="test.$(seed).trees">
            <log idref="tree"/>
        </logger>
        <logger logEvery="10000">
	    <model idref='posterior'/>
            <log idref="coalescent"/>
            <log idref="likelihood"/>
            <log spec='beast.base.evolution.tree.TreeHeightLogger'>
                <tree idref='tree'/>
            </log>
            <log idref="popSize"/>
            <log idref="hky.kappa"/>
            <log idref="nodeLogRates"/>
            <log idref="rootLogRate"/>
            <log idref="sigma2"/>
<!--            <log idref="meanRate"/>-->
            <log idref="posterior"/>
        </logger>
    </run>

</beast>
